\subsection{Разработка даталогической и физической моделей базы данных}
\label{sec:design:db}

Как было упомянуто ранее, в программном средстве, описываемом данным дипломным проектом, будет использоваться специализированная СУБД MongoDB \cite{mongo}.

MongoDB реализует новый подход к построению баз данных, где нет таблиц, схем, запросов SQL, внешних ключей и многих других вещей, которые присущи объектно-реляционным базам данных.

Но, даже учитывая все недостатки традиционных баз данных и достоинства MongoDB, важно понимать, что задачи бывают разные и методы их решения бывают разные. В какой-то ситуации MongoDB действительно улучшит производительность вашего приложения, например, если надо хранить сложные по структуре данные. В другой же ситуации лучше будет использовать традиционные реляционные базы данных. Кроме того, можно использовать смешанный подход.

Вся система MongoDB может представлять не только одну базу данных, находящуюся на одном физическом сервере. Функциональность \linebreak MongoDB позволяет расположить несколько баз данных на нескольких физических серверах, и эти базы данных смогут легко обмениваться данными и сохранять целостность.

На даталогическом уровне модель предметной области представляется в привязке к конкретной СУБД и описывает способ организации данных безотносительно их физического размещения. Описывать модель можно с помощью специальных графических нотаций \cite{kulikov_db_workbook}. 

Модель даталогического уровня разработаем на основании инфологической модели, описание которой приведено в пункте \ref{sec:domain:model:db}. 

Одним из популярных стандартов обмена данными и их хранения является JSON (JavaScript Object Notation). JSON эффективно описывает сложные по структуре данные. Способ хранения данных в MongoDB в этом плане похож на JSON, хотя формально JSON не используется. Для хранения в MongoDB применяется формат, который называется BSON (БиСон) или сокращение от binary JSON.

BSON позволяет работать с данными быстрее: быстрее выполняется поиск и обработка. Хотя надо отметить, что BSON в отличие от хранения данных в формате JSON имеет небольшой недостаток: в целом данные в JSON-формате занимают меньше места, чем в формате BSON, с другой стороны, данный недостаток с лихвой окупается скоростью.

Использование MongoDB даёт определенные преимущества. Например, появляется возможность использовать сколь угодно сложные структуры данных и легко сохранять и извлекать их. Таким образом, даталогическую модель используемой в разрабатываемом приложении БД можно проектировать с использованием традиционной диаграммы классов UML.

Описание схемы БД в специальной нотации, используемой в \linebreak MongoDB, приведено в приложении \dbschemeappendix.

Особенностью приложения является применение объектов древовидной структуры в качестве сущностей базы данных. Сделано это было для возможности реализации так называемого контекстного диалога, с помощью которого бот может понять, на какой стадии сейчас находится пользователь. Также, данная структура устойчива к возникновению исключительных ситуаций. В случае возникновения ошибки, либо длительного отсутствия ответа от пользователя, приложение все равно будет знать, на какой стадии диалога остановился пользователь. 

Вследствие этого можно заметить еще одно проявление денормализации: в некоторой дочерней сущности содержится ссылка на родительскую, а родительская содержит список дочерних. Опять же, данное решение вследствие отсутствии необходимости поиска позволит значительно повысить производительность при выборке данных.

Физический уровень моделирования БД описывает конкретные таблицы, связи, индексы, методы хранения, настройки производительности, безопасности. Описывать модель можно с помощью средств, уместных для предметной области~\cite{kulikov_db_workbook}. 

Индексы -- это специальные структуры, применяемые для ускорения операций взаимодействия с данными. Целесообразно реализовать индексы по:

\begin{itemize}
	\item имени пользователя;
	\item названию категорий;
	\item типу категорий.
\end{itemize}

Для идентификации используется специальное поле id, имеющее тип Guid и внедряется во все сущности с помощью наследования от сущности BaseModel.

Остальные настройки будут применяться непосредственно при развертывании программной системы, поэтому в данном разделе не\linebreakрассматриваются.
